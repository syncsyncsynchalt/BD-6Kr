# BD-6Kr

このプロジェクトは、PlayStation Vita用ビデオゲームの戦闘ロジックを、スタンドアロンの.NET アプリケーションとして強引に動作させる試みです。

## ルール

面倒な箇所は戦闘の結果に影響を与えない範囲でオリジナルの実装に手を加える場合があります。

- PS VitaやUnityなしでも動作させる。UnityEngineなどはスタブに置き換える。
- 非同期処理を同期処理に変える場合がある。毎フレームどうこうする訳ではないので。
- スコープをpublicに変える。雑に穿り回したいので。

## 技術仕様

- **ターゲットフレームワーク**: .NET 9.0
- **開発環境**: Visual Studio Code, C# (.NET) devcontainer
- **アーキテクチャ**: x86/x64/ARM64 対応

## 実行方法

```bash
dotnet build BD-6Kr.sln
dotnet build Runner/Runner.csproj
dotnet run --project Runner
```

結果が標準出力に垂れ流されます。

```
システム/マスタデータ初期化
  システム初期化を開始...
  マスタデータ初期化を開始...
  Mst_DataManagerでマスタデータを読み込み中...
  マスタデータマネージャーを初期化中...
  マスタデータ読み込み完了
  マスタデータマネージャーの初期化完了
  Appクラスでセーブデータを初期化中...
  AppInitializeManagerの初期化完了
  Appクラスでシステムを初期化...
  ManagerBaseで基本マネージャーを初期化...
  システム初期化完了

提督（プレイヤー）情報の設定
  提督情報の初期化を開始...
  難易度: OTU
  提督名: 新米提督
  初期艦娘: 吹雪 (ID: 9)
  セーブデータを正常に作成しました

基本的なゲームリソースの設定
  基本的なゲームリソースを設定中...
  基本資源: 燃料1000, 弾薬1000, 鋼材1000, ボーキサイト1000
  高速修復材: 10個, 開発資材: 10個
  初期家具コイン: 5,000
  基本リソース設定完了
  追加の艦娘を配備中...
  追加艦娘: 5隻
    - 大井 (ID: 24)
    - Z3 (ID: 175)
    - 瑞鳳改 (ID: 117)
    - 飛鷹 (ID: 75)
    - 大淀改 (ID: 321)
  基本装備を配備中...
  基本装備: 40個

艦隊編成の準備

エリア/マップ/セルの一覧
■ エリアID: 1, 名称: 鎮守府海域
  マップNo: 1, 名称: 鎮守府正面海域 (紐づくセル数: 4)
      - セルNo: 0, イベントタイプ: NOT_USE, 戦闘タイプ: None | 次: 1
      - セルNo: 1, イベントタイプ: War_Normal, 戦闘タイプ: Normal | 次: 2(50%) / 3(50%)
      - セルNo: 2, イベントタイプ: War_Normal, 戦闘タイプ: Normal
      - セルNo: 3, イベントタイプ: War_Boss, 戦闘タイプ: Normal
  マップNo: 2, 名称: 鎮守府海域沖 (紐づくセル数: 5)
      - セルNo: 0, イベントタイプ: NOT_USE, 戦闘タイプ: None | 次: 1(50%) / 2(50%)
      - セルNo: 1, イベントタイプ: War_Normal, 戦闘タイプ: Normal | 次: 3
      - セルNo: 2, イベントタイプ: ItemGet, 戦闘タイプ: None | 次: 4
      - セルNo: 3, イベントタイプ: War_Boss, 戦闘タイプ: Normal
      - セルNo: 4, イベントタイプ: War_Normal, 戦闘タイプ: Normal
  マップNo: 3, 名称: 海上通商護衛路 (紐づくセル数: 10)
      - セルNo: 0, イベントタイプ: NOT_USE, 戦闘タイプ: None | 次: 2(50%) / 1(50%)
      - セルNo: 1, イベントタイプ: War_Normal, 戦闘タイプ: Normal | 次: 3
      - セルNo: 2, イベントタイプ: Uzushio, 戦闘タイプ: None | 次: 5(70%) / 4(30%)
      - セルNo: 3, イベントタイプ: ItemGet, 戦闘タイプ: None | 次: 7(50%) / 8(50%)
      - セルNo: 4, イベントタイプ: ItemGet, 戦闘タイプ: None | 次: 6
      - セルNo: 5, イベントタイプ: War_Normal, 戦闘タイプ: Normal | 次: 9
      - セルNo: 6, イベントタイプ: War_Normal, 戦闘タイプ: Normal
      - セルNo: 7, イベントタイプ: War_Boss, 戦闘タイプ: Normal
      - セルNo: 8, イベントタイプ: ItemGet, 戦闘タイプ: None | 次: 6
      - セルNo: 9, イベントタイプ: War_Normal, 戦闘タイプ: Normal
  マップNo: 4, 名称: 近海諸島防衛線 (紐づくセル数: 14)
      - セルNo: 0, イベントタイプ: NOT_USE, 戦闘タイプ: None | 次: 3(33%) / 2(33%) / 1(34%)
      - セルNo: 1, イベントタイプ: War_Normal, 戦闘タイプ: Normal | 次: 4
      - セルNo: 2, イベントタイプ: War_Normal, 戦闘タイプ: Normal | 次: 11
      - セルNo: 3, イベントタイプ: ItemGet, 戦闘タイプ: None | 次: 5
      - セルNo: 4, イベントタイプ: ItemGet, 戦闘タイプ: None | 次: 6(50%) / 7(50%)
      - セルNo: 5, イベントタイプ: ItemGet, 戦闘タイプ: None | 次: 8
      - セルNo: 6, イベントタイプ: ItemGet, 戦闘タイプ: None | 次: 10
      - セルNo: 7, イベントタイプ: War_Normal, 戦闘タイプ: Normal | 次: 12
      - セルNo: 8, イベントタイプ: War_Normal, 戦闘タイプ: Normal | 次: 13(30%) / 9(70%)
      - セルNo: 9, イベントタイプ: War_Normal, 戦闘タイプ: Normal
      - セルNo: 10, イベントタイプ: War_Boss, 戦闘タイプ: Normal
      - セルNo: 11, イベントタイプ: ItemGet, 戦闘タイプ: None | 次: 6(50%) / 7(50%)
      - セルNo: 12, イベントタイプ: War_Boss, 戦闘タイプ: Normal
      - セルNo: 13, イベントタイプ: War_Boss, 戦闘タイプ: Normal
  マップNo: 5, 名称: 鎮守府海域－EO1 (紐づくセル数: 4)
      - セルNo: 0, イベントタイプ: NOT_USE, 戦闘タイプ: None | 次: 1
      - セルNo: 1, イベントタイプ: War_Normal, 戦闘タイプ: Normal | 次: 2(50%) / 3(50%)
      - セルNo: 2, イベントタイプ: War_Normal, 戦闘タイプ: Normal
      - セルNo: 3, イベントタイプ: War_Boss, 戦闘タイプ: Normal
  マップNo: 6, 名称: 鎮守府海域－EO2 (紐づくセル数: 4)
      - セルNo: 0, イベントタイプ: NOT_USE, 戦闘タイプ: None | 次: 1
      - セルNo: 1, イベントタイプ: War_Normal, 戦闘タイプ: Normal | 次: 2(50%) / 3(50%)
      - セルNo: 2, イベントタイプ: War_Normal, 戦闘タイプ: Normal
      - セルNo: 3, イベントタイプ: War_Boss, 戦闘タイプ: Normal
  マップNo: 7, 名称: 本土沖海戦 (紐づくセル数: 8)
      - セルNo: 0, イベントタイプ: NOT_USE, 戦闘タイプ: None | 次: 1
      - セルNo: 1, イベントタイプ: Stupid, 戦闘タイプ: Midnight | 次: 2(50%) / 3(50%)
      - セルNo: 2, イベントタイプ: War_Normal, 戦闘タイプ: Normal | 次: 4
      - セルNo: 3, イベントタイプ: War_Normal, 戦闘タイプ: Normal | 次: 7
      - セルNo: 4, イベントタイプ: War_Normal, 戦闘タイプ: Normal | 次: 5
      - セルNo: 5, イベントタイプ: War_Normal, 戦闘タイプ: Normal | 次: 6
      - セルNo: 6, イベントタイプ: War_Boss, 戦闘タイプ: Normal
      - セルNo: 7, イベントタイプ: War_Normal, 戦闘タイプ: Normal | 次: 5

出撃準備とマップ選択
  エリア5のマップ5-1を選択

戦闘実行: 5-1
  戦闘を実行中...
  StrategyMapManagerを初期化中...
  エリア5を選択中...
  マップ5-1に出撃中...
  実際のマップID: 51
SortieManager.GoSortie: deck_id=1, map_id=51
SortieMapManager constructor: deck=1, map=1, _req_map=Server_Controllers.Api_req_Map
SortieMapManager._Init(): Map.AreaId=5, Map.No=1, Deck.Id=1
  出撃成功！（エリア5、マップ1）

=== 出撃艦隊の状態 ===
  艦隊規模: 6隻
  1. 吹雪 (Lv.1) HP:15/15 [無傷]
  2. 大井 (Lv.1) HP:25/25 [無傷]
  3. Z3 (Lv.1) HP:18/18 [無傷]
  4. 瑞鳳改 (Lv.1) HP:45/45 [無傷]
  5. 飛鷹 (Lv.1) HP:40/40 [無傷]
  6. 大淀改 (Lv.1) HP:47/47 [無傷]

=== 敵艦隊の情報 ===
  マップ: 5-1 (ショートランド沖)
  敵艦隊規模: 6隻
  1. 軽巡ヘ級 HP:57 (火力:48/雷装:80)
  2. 駆逐イ級後期型 HP:35 (火力:38/雷装:60)
  3. 駆逐イ級後期型 HP:35 (火力:38/雷装:60)
  4. 駆逐イ級 HP:20 (火力:5/雷装:15)
  5. 駆逐イ級 HP:20 (火力:5/雷装:15)
  6. 駆逐イ級 HP:20 (火力:5/雷装:15)
  戦闘開始！（エリア5、マップ1、陣形: 単縦陣）
  戦闘指揮を準備中...
  コマンドフェーズモデルを取得しました
  戦闘指揮数: 3
  戦闘指揮の内容: Kouku(航空戦), Hougeki(砲撃戦), Raigeki(雷撃戦)
  選択可能な戦闘指揮: Sekkin(接近戦), Hougeki(砲撃戦), Raigeki(雷撃戦), Ridatu(離脱), Taisen(対潜戦), Kaihi(回避), Kouku(航空戦)
  戦闘指揮の実行結果: True: [戦闘指揮] 指揮済 (Kouku, Hougeki, Raigeki)
  戦闘指揮の実行完了
  昼戦結果を計算中...
  昼戦完了！
  夜戦突入可能です
  夜戦を開始します...
  夜戦の前処理を実行中...
    夜戦データを取得中...
    艦娘の夜戦開始状態を記録中...
    自軍艦娘の状態を記録中...
      吹雪: HP 15/15 (Normal)
      大井: HP 2/25 (Taiha)
      Z3: HP 1/18 (Taiha)
      瑞鳳改: HP 19/45 (Tyuuha)
      飛鷹: HP 40/40 (Normal)
      大淀改: HP 1/47 (Taiha)
    自軍艦娘 6隻の状態を記録しました
    敵軍艦娘の状態を記録中...
    敵軍艦娘 0隻の状態を記録しました
    夜戦用キャッシュデータを更新中...
    夜戦用データを準備中...
    夜戦データを取得しました
    夜戦攻撃データを準備しました（攻撃数: 5）
  夜戦の前処理完了
  夜戦中...
  夜戦結果を取得しました
  夜戦完了！

=== 戦闘結果 ===
  勝利判定: D / MVP: 吹雪(0)(mstId:9)[15/15 => 15/15(15/15)]番艦
  敵艦:
    1. 軽巡ヘ級: 57 → 57 [無傷]
    2. 駆逐イ級後期型: 35 → 0 [撃沈]
    3. 駆逐イ級後期型: 35 → 9 [中破]
    4. 駆逐イ級: 20 → 20 [無傷]
    5. 駆逐イ級: 20 → 0 [撃沈]
    6. 駆逐イ級: 20 → 20 [無傷]
  撃沈数: 2/6隻
  味方艦隊:
    1. 吹雪: 15 → 15 [無傷]
    2. 大井: 25 → 2 [大破]
    3. Z3: 18 → 1 [大破]
    4. 瑞鳳改: 45 → 19 [中破]
    5. 飛鷹: 40 → 40 [無傷]
    6. 大淀改: 47 → 1 [大破]
  戦闘終了
  5-1戦闘完了！

出撃準備とマップ選択
  エリア5のマップ5-2を選択

戦闘実行: 5-2
  戦闘を実行中...
  StrategyMapManagerを初期化中...
  エリア5を選択中...
  マップ5-2に出撃中...
  実際のマップID: 52
SortieManager.GoSortie: deck_id=1, map_id=52
SortieMapManager constructor: deck=1, map=2, _req_map=Server_Controllers.Api_req_Map
SortieMapManager._Init(): Map.AreaId=5, Map.No=2, Deck.Id=1
  出撃成功！（エリア5、マップ2）

=== 出撃艦隊の状態 ===
  艦隊規模: 6隻
  1. 吹雪 (Lv.5) HP:15/15 [無傷]
  2. 大井 (Lv.3) HP:2/25 [大破]
  3. Z3 (Lv.3) HP:1/18 [大破]
  4. 瑞鳳改 (Lv.3) HP:19/45 [中破]
  5. 飛鷹 (Lv.3) HP:40/40 [無傷]
  6. 大淀改 (Lv.3) HP:1/47 [大破]

=== 敵艦隊の情報 ===
  マップ: 5-2 (南方海域珊瑚諸島沖)
  敵艦隊規模: 6隻
  1. 軽巡ヘ級 HP:57 (火力:48/雷装:80)
  2. 駆逐イ級後期型 HP:35 (火力:38/雷装:60)
  3. 駆逐イ級 HP:20 (火力:5/雷装:15)
  4. 駆逐イ級 HP:20 (火力:5/雷装:15)
  5. 潜水カ級 HP:19 (火力:0/雷装:42)
  戦闘開始！（エリア5、マップ2、陣形: 単縦陣）
  戦闘指揮を準備中...
  コマンドフェーズモデルを取得しました
  戦闘指揮数: 3
  戦闘指揮の内容: Kouku(航空戦), Hougeki(砲撃戦), Raigeki(雷撃戦)
  選択可能な戦闘指揮: Sekkin(接近戦), Hougeki(砲撃戦), Raigeki(雷撃戦), Ridatu(離脱), Taisen(対潜戦), Kaihi(回避), Kouku(航空戦)
  戦闘指揮の実行結果: True: [戦闘指揮] 指揮済 (Kouku, Hougeki, Raigeki)
  戦闘指揮の実行完了
  昼戦結果を計算中...
  昼戦完了！
  夜戦突入可能です
  夜戦を開始します...
  夜戦の前処理を実行中...
    夜戦データを取得中...
    艦娘の夜戦開始状態を記録中...
    自軍艦娘の状態を記録中...
      吹雪: HP 15/15 (Normal)
      大井: HP 2/25 (Taiha)
      Z3: HP 0/18 (Gekichin)
      瑞鳳改: HP 1/45 (Taiha)
      飛鷹: HP 1/40 (Taiha)
      大淀改: HP 1/47 (Taiha)
    自軍艦娘 6隻の状態を記録しました
    敵軍艦娘の状態を記録中...
    敵軍艦娘 0隻の状態を記録しました
    夜戦用キャッシュデータを更新中...
    夜戦用データを準備中...
    夜戦データを取得しました
    夜戦攻撃データを準備しました（攻撃数: 4）
  夜戦の前処理完了
  夜戦中...
  夜戦結果を取得しました
  夜戦完了！

=== 戦闘結果 ===
  勝利判定: D / MVP: 飛鷹(4)(mstId:75)[1/40 => 1/40(40/40)]番艦
  敵艦:
    1. 軽巡ヘ級: 57 → 57 [無傷]
    2. 駆逐イ級後期型: 35 → 33 [無傷]
    3. 駆逐イ級: 20 → 0 [撃沈]
    4. 駆逐イ級: 20 → 0 [撃沈]
    5. 潜水カ級: 19 → 18 [無傷]
  撃沈数: 2/6隻
  味方艦隊:
    1. 吹雪: 15 → 15 [無傷]
    2. 大井: 2 → 2 [大破]
    3. Z3: 1 → 0 [轟沈]
    4. 瑞鳳改: 19 → 1 [大破]
    5. 飛鷹: 40 → 1 [大破]
    6. 大淀改: 1 → 1 [大破]
  戦闘終了
  5-2戦闘完了！
```